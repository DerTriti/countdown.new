<!DOCTYPE html>
<html lang="en" data-theme="light" data-design="default" data-glass-blur="true" data-accessible="false" data-panel-style="minimal" data-mobile="classic" data-standby="off">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Is it Christmas?</title>
<style>
:root{--bg:#f7f7f8;--card:#fff;--text:#0f172a;--muted:#6b7280;--border:#e5e7eb;--accent:#111827;--focus:2px solid #3b82f6;--shadow:0 14px 30px rgba(0,0,0,.10);--glass-bg:rgba(255,255,255,.55);--glass-border:rgba(255,255,255,.35);--glass-shadow:0 20px 40px rgba(0,0,0,.12);--container-w:960px;--font-scale:1;--contrast-mult:1;--backdrop:rgba(15,23,42,.35)}
html[data-theme="dark"]{--bg:#0b0f19;--card:#121826;--text:#e5e7eb;--muted:#9ca3af;--border:#1f2937;--accent:#e5e7eb;--focus:2px solid #60a5fa;--glass-bg:rgba(18,24,38,.55);--glass-border:rgba(255,255,255,.16);--glass-shadow:0 20px 50px rgba(0,0,0,.45);--backdrop:rgba(0,0,0,.45)}
html[data-accessible="true"]{--font-scale:1.08;--contrast-mult:1.15}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:color-mix(in oklab,var(--text) calc(100% * var(--contrast-mult)),black 0%);font:calc(16px * var(--font-scale))/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;display:grid;place-items:center;padding:24px;transition:background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease}
.card{width:min(var(--container-w),92vw);background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.06);transition:background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease}
.row{display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
html[data-design="professional"] .card{padding:28px}
html[data-design="professional"] .controls{gap:18px}
html[data-design="glass"] body{background:radial-gradient(1200px 1200px at 10% 10%,rgba(255,255,255,.06),transparent 60%),radial-gradient(1200px 1200px at 90% 90%,rgba(255,255,255,.06),transparent 60%),var(--bg)}
html[data-design="glass"] .card{background:var(--glass-bg);border:1px solid var(--glass-border);box-shadow:var(--glass-shadow)}
html[data-design="glass"][data-glass-blur="true"] .card{backdrop-filter:blur(10px)}
.dropdown{position:relative;min-width:280px}
.dropdown-toggle{width:100%;background:var(--card);color:inherit;border:1px solid var(--border);padding:10px 14px;border-radius:10px;text-align:left;cursor:pointer;display:flex;align-items:center;justify-content:space-between;gap:12px;transition:background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease}
.dropdown-toggle:focus-visible{outline:var(--focus)}
.dropdown-menu{position:absolute;left:0;right:0;background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:8px;display:none;z-index:25;transition:background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease}
.dropdown.open.down .dropdown-menu{display:block;top:calc(100% + 8px)}
.dropdown.open.up .dropdown-menu{display:block;bottom:calc(100% + 8px)}
.search-wrap{padding:6px}
.search-input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:transparent;color:inherit;outline:none;transition:background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease}
.search-input:focus{outline:var(--focus)}
.list{margin-top:8px;max-height:60vh;overflow-y:auto;padding:4px;scroll-behavior:smooth;scrollbar-width:none;-ms-overflow-style:none}
.list::-webkit-scrollbar{display:none}
.item{width:100%;display:flex;justify-content:space-between;align-items:center;gap:12px;border:0;background:transparent;text-align:left;padding:10px 12px;border-radius:8px;cursor:pointer;color:inherit;transition:background .15s ease}
.item:hover{background:rgba(0,0,0,.06)}
html[data-theme="dark"] .item:hover{background:rgba(255,255,255,.06)}
.muted{color:var(--muted);font-size:.94rem}
.icon-btn{border:1px solid var(--border);background:var(--card);color:inherit;padding:10px 12px;border-radius:10px;cursor:pointer;transition:background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease}
.icon-btn:focus-visible{outline:var(--focus)}
.select{border:1px solid var(--border);background:transparent;color:inherit;border-radius:10px;padding:8px 10px;transition:background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease}
.radio-group{display:flex;gap:10px;flex-wrap:wrap}
.radio{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);padding:8px 10px;border-radius:10px;cursor:pointer;background:transparent;transition:background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease}
.switch{position:relative;width:86px;height:32px;background:var(--border);border-radius:999px;padding:3px;display:inline-flex;align-items:center;cursor:pointer}
.switch input{display:none}
.knob{width:26px;height:26px;border-radius:50%;background:var(--accent);transition:transform .22s ease}
.switch input:checked + .knob{transform:translateX(54px)}
.modal-overlay{position:fixed;inset:0;display:none;place-items:center;background:rgba(15,23,42,.35);backdrop-filter:blur(6px);z-index:60}
.modal-overlay.open{display:grid}
.modal{width:min(700px,92vw);background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);transition:background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease;overflow:hidden}
html[data-panel-style="minimal"] .modal{padding:6px 0}
html[data-panel-style="professional"] .modal{padding:8px 0}
html[data-panel-style="modern"] .modal{padding:10px 0}
html[data-panel-style="ultra"] .modal{padding:12px 0}
.modal-header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-title{font-weight:800}
.close-btn{all:unset;cursor:pointer;padding:6px 8px;border:1px solid var(--border);border-radius:8px}
.modal-body{max-height:72vh;overflow:auto;scrollbar-width:none;-ms-overflow-style:none}
.modal-body::-webkit-scrollbar{display:none}
.section{border-top:1px solid var(--border)}
.section:first-of-type{border-top:0}
.section-title{display:flex;align-items:center;gap:10px;padding:12px 16px;cursor:pointer;user-select:none}
.section-title::before,.section-title::after{content:"";height:1px;background:var(--border);flex:1}
.section-title span{white-space:nowrap;font-weight:700;padding:0 6px}
.section-content{display:none;padding:12px 16px}
.section.open .section-content{display:block}
.row-flex{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:10px 0}
.col{display:flex;flex-direction:column;gap:6px}
.desc{font-size:.92rem;color:var(--muted)}
h1{margin:12px 0 8px;font-size:clamp(1.6rem,3.5vw,2.2rem);font-weight:800;letter-spacing:-.02em}
#answer{font-size:clamp(1.4rem,3.5vw,2rem);font-weight:700;margin:8px 0 2px}
#countdown{font-variant-numeric:tabular-nums;letter-spacing:.4px}
.spacer{height:8px}
.footer{margin-top:10px;font-size:.92rem;color:var(--muted)}
#snowCanvas{position:fixed;inset:0;pointer-events:none;display:none;z-index:5}
html[data-mobile="optimized"] .card{width:min(100vw,100%);border-radius:0;border-left:none;border-right:none;min-height:100dvh}
html[data-mobile="optimized"] .controls{gap:10px}
@media (max-width:520px){.dropdown{min-width:unset;width:100%}.controls{width:100%}.icon-btn{width:auto}}
@media (max-width:420px){.modal{width:96vw}.row-flex{flex-wrap:wrap}.select{width:100%}}
@media (max-width:390px){html[data-mobile="optimized"] .modal{width:100vw;height:100dvh;border-radius:0}}
#standbyLayer{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;gap:16px;z-index:80}
#standbyMain{max-width:min(92vw,900px);text-align:center}
#standbyClock{font-variant-numeric:tabular-nums}
#standbyExit{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;border:1px solid var(--border);background:var(--card);color:inherit;border-radius:10px;font-size:.9rem;padding:8px 14px;cursor:pointer;opacity:.9}
html[data-theme="dark"] #standbyExit{background:#0e1526}
</style>
</head>
<body>
<canvas id="snowCanvas"></canvas>
<div id="loadingOverlay" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.25);backdrop-filter:blur(3px);z-index:70"><div style="padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:var(--card);color:inherit">Loading preferences…</div></div>
<div id="standbyLayer"><div id="standbyMain"></div><div id="standbyClock" class="muted"></div><button id="standbyExit">Esci</button></div>
<div class="card" role="region" aria-label="Is it Christmas widget">
  <div class="row">
    <div class="controls">
      <div class="dropdown" id="langDropdown">
        <button class="dropdown-toggle" id="dropdownButton" aria-expanded="false" aria-haspopup="listbox">
          <span id="dropdownLabel">English — Europe/London</span>
          <span aria-hidden="true">▾</span>
        </button>
        <div class="dropdown-menu" id="dropdownMenu" role="listbox" aria-label="Select language and time zone">
          <div class="search-wrap">
            <input id="searchInput" class="search-input" type="text" placeholder="Search language..." autocomplete="off" />
          </div>
          <div id="list" class="list" role="listbox"></div>
        </div>
      </div>
      <button class="icon-btn" id="openSettingsBtn" aria-haspopup="dialog">Settings</button>
    </div>
  </div>
  <h1 id="title">Is it Christmas?</h1>
  <div id="today" class="muted"></div>
  <div id="answer"></div>
  <div id="countdown" class="muted"></div>
  <div class="spacer"></div>
  <div class="footer" id="tzInfo"></div>
</div>
<div class="modal-overlay" id="settingsOverlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Settings panel">
    <div class="modal-header">
      <div class="modal-title" id="settingsTitle">Settings</div>
      <button class="close-btn" id="closeSettingsBtn" aria-label="Close">Close</button>
    </div>
    <div class="modal-body">
      <section class="section" data-sec="appearance"><div class="section-title"><span>Appearance</span></div><div class="section-content">
        <div class="row-flex"><div class="col"><div class="settings-title" data-i18n="themeTitle">Theme</div><div class="desc" data-i18n="themeDesc">Switch between Light and Dark.</div></div><label class="switch"><input type="checkbox" id="themeInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title" data-i18n="designTitle">Design style</div><div class="desc" data-i18n="designDesc">Choose the visual style of the app.</div></div><div class="radio-group" id="designGroup"><label class="radio"><input type="radio" name="design" value="default"> <span data-i18n="designDefault">Default</span></label><label class="radio"><input type="radio" name="design" value="professional"> <span data-i18n="designPro">Professional</span></label><label class="radio"><input type="radio" name="design" value="glass"> <span data-i18n="designGlass">Glass</span></label></div></div>
        <div class="row-flex" id="glassRow" style="display:none"><div class="col"><div class="settings-title" data-i18n="glassTitle">Glass blur</div><div class="desc" data-i18n="glassDesc">Enable blur effect for the glass theme.</div></div><label class="switch"><input type="checkbox" id="glassBlurInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Interface animation</div><div class="desc">Enable subtle transitions.</div></div><label class="switch"><input type="checkbox" id="uiAnimInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Settings panel style</div><div class="desc">Look & feel of this panel.</div></div><div class="radio-group" id="panelStyleGroup"><label class="radio"><input type="radio" name="panelstyle" value="minimal" checked> <span>Minimal</span></label><label class="radio"><input type="radio" name="panelstyle" value="professional"> <span>Professional</span></label><label class="radio"><input type="radio" name="panelstyle" value="modern"> <span>Modern Pro</span></label><label class="radio"><input type="radio" name="panelstyle" value="ultra"> <span>Ultra</span></label></div></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Snow effect</div><div class="desc">Falling snow overlay.</div></div><label class="switch"><input type="checkbox" id="snowInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Mobile style</div><div class="desc">Classic or mobile-optimized.</div></div><div class="radio-group" id="mobileStyleGroup"><label class="radio"><input type="radio" name="mobile" value="classic" checked> <span>Classic responsive</span></label><label class="radio"><input type="radio" name="mobile" value="optimized"> <span>Mobile optimized</span></label></div></div>
      </div></section>
      <section class="section" data-sec="language"><div class="section-title"><span>Language</span></div><div class="section-content">
        <div class="row-flex"><div class="col"><div class="settings-title" data-i18n="autoDetect">Auto-detect device language</div><div class="desc" data-i18n="autoDetectDesc">Use your device language at first visit.</div></div><label class="switch"><input type="checkbox" id="autoDetectInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title" data-i18n="advancedDetect">Advanced detection (browser priority)</div><div class="desc" data-i18n="advancedDetectDesc">Check navigator.languages in order.</div></div><label class="switch"><input type="checkbox" id="advancedDetectInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title" data-i18n="fallbackTitle">Fallback strategy</div><div class="desc" data-i18n="fallbackDesc">When your language isn’t available.</div></div><div class="radio-group" id="fallbackGroup"><label class="radio"><input type="radio" name="fallback" value="smart"> <span data-i18n="fallbackSmart">Smart (similar)</span></label><label class="radio"><input type="radio" name="fallback" value="en"> <span>English</span></label></div></div>
        <div class="row-flex"><div class="col"><div class="settings-title" data-i18n="uiLangTitle">Interface language</div><div class="desc" data-i18n="uiLangDesc">Texts of the interface only.</div></div><select id="uiLangSelect" class="select" aria-label="Interface language"><option value="en">English</option><option value="it">Italiano</option><option value="es">Español</option><option value="fr">Français</option><option value="de">Deutsch</option></select></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Show weekday name</div><div class="desc">Include the weekday in date.</div></div><label class="switch"><input type="checkbox" id="weekdayInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Use long month names</div><div class="desc">e.g. December instead of 12.</div></div><label class="switch"><input type="checkbox" id="longMonthInput" /><span class="knob"></span></label></div>
      </div></section>
      <section class="section" data-sec="langmenu"><div class="section-title"><span>Language menu</span></div><div class="section-content">
        <div class="row-flex"><div class="col"><div class="settings-title" data-i18n="dirTitle">Open direction</div><div class="desc" data-i18n="dirDesc">Down, Up or Auto.</div></div><div class="radio-group" id="dirGroup"><label class="radio"><input type="radio" name="dir" value="auto"> <span data-i18n="dirAuto">Auto</span></label><label class="radio"><input type="radio" name="dir" value="down"> <span data-i18n="dirDown">Down</span></label><label class="radio"><input type="radio" name="dir" value="up"> <span data-i18n="dirUp">Up</span></label></div></div>
      </div></section>
      <section class="section" data-sec="countdown"><div class="section-title"><span>Countdown</span></div><div class="section-content">
        <div class="row-flex"><div class="col"><div class="settings-title">Show Christmas countdown</div><div class="desc">If off, only the answer is shown.</div></div><label class="switch"><input type="checkbox" id="countdownInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Also count to Christmas Eve (24)</div><div class="desc">Enable a separate counter to Dec 24.</div></div><label class="switch"><input type="checkbox" id="xmasEveInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Count to New Year (Jan 1)</div><div class="desc">Add a new year countdown.</div></div><label class="switch"><input type="checkbox" id="newYearInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Custom countdown date</div><div class="desc">Pick any target date.</div></div><input type="date" id="customDateInput" class="select" /></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Countdown format</div><div class="desc">Days only or days + time.</div></div><div class="radio-group" id="countFormatGroup"><label class="radio"><input type="radio" name="countfmt" value="days"> <span>Days only</span></label><label class="radio"><input type="radio" name="countfmt" value="full" checked> <span>Days + time</span></label></div></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Countdown style</div><div class="desc">Normal, Minimal or Large.</div></div><div class="radio-group" id="countStyleGroup"><label class="radio"><input type="radio" name="countstyle" value="normal" checked> <span>Normal</span></label><label class="radio"><input type="radio" name="countstyle" value="minimal"> <span>Minimal</span></label><label class="radio"><input type="radio" name="countstyle" value="large"> <span>Large</span></label></div></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Loading screen</div><div class="desc">Show a short loading at start.</div></div><label class="switch"><input type="checkbox" id="loadingInput" /><span class="knob"></span></label></div>
      </div></section>
      <section class="section" data-sec="a11y"><div class="section-title"><span>Accessibility</span></div><div class="section-content">
        <div class="row-flex"><div class="col"><div class="settings-title">High contrast</div><div class="desc">Boost overall contrast.</div></div><label class="switch"><input type="checkbox" id="a11yContrastInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Bigger text</div><div class="desc">Increase base font size.</div></div><label class="switch"><input type="checkbox" id="a11yTextInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Readable font</div><div class="desc">Use a dyslexia-friendly font.</div></div><label class="switch"><input type="checkbox" id="a11yFontInput" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Visible focus</div><div class="desc">Always show focus outline.</div></div><label class="switch"><input type="checkbox" id="a11yFocusInput" /><span class="knob"></span></label></div>
      </div></section>
      <section class="section" data-sec="translations"><div class="section-title"><span>Translations</span></div><div class="section-content">
        <div class="row-flex"><div class="col"><div class="settings-title" id="trStyleLabel">Translation style</div><div class="desc" id="trStyleDesc">Choose how strictly texts are localized.</div></div><div class="radio-group" id="trStyleGroup"><label class="radio"><input type="radio" name="trstyle" value="B" checked> <span>Modern</span></label><label class="radio"><input type="radio" name="trstyle" value="A"> <span>Full local</span></label></div></div>
      </div></section>
      <section class="section" data-sec="standby"><div class="section-title"><span>Standby mode</span></div><div class="section-content">
        <div class="row-flex"><div class="col"><div class="settings-title">Enable standby</div><div class="desc">Energy saver, clean screen.</div></div><label class="switch"><input type="checkbox" id="sbEnable" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Standby style</div><div class="desc">Visual style of standby.</div></div><div class="radio-group" id="sbStyleGroup"><label class="radio"><input type="radio" name="sbstyle" value="minimal" checked> <span>Minimal</span></label><label class="radio"><input type="radio" name="sbstyle" value="elegant"> <span>Elegant</span></label><label class="radio"><input type="radio" name="sbstyle" value="futuristic"> <span>Futuristic</span></label></div></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Only countdown</div><div class="desc">Show only countdown in standby.</div></div><label class="switch"><input type="checkbox" id="sbOnlyCountdown" checked /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Hide animations</div><div class="desc">Disable snow and transitions.</div></div><label class="switch"><input type="checkbox" id="sbNoAnim" checked /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Dark screen</div><div class="desc">Black background, light text.</div></div><label class="switch"><input type="checkbox" id="sbDark" checked /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Auto by inactivity</div><div class="desc">Enter standby after idle time.</div></div><label class="switch"><input type="checkbox" id="sbAuto" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Idle minutes</div><div class="desc">How many minutes to wait.</div></div><select id="sbIdleMins" class="select"><option value="5">5</option><option value="10" selected>10</option><option value="30">30</option></select></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Sleep after (minutes)</div><div class="desc">Turn screen off after time.</div></div><select id="sbSleepMins" class="select"><option value="0">Off</option><option value="30">30</option><option value="60">60</option></select></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Digital clock</div><div class="desc">Show a large clock.</div></div><label class="switch"><input type="checkbox" id="sbClock" /><span class="knob"></span></label></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Clock format</div><div class="desc">12h or 24h.</div></div><div class="radio-group" id="sbClockFmt"><label class="radio"><input type="radio" name="sbfmt" value="24" checked> <span>24h</span></label><label class="radio"><input type="radio" name="sbfmt" value="12"> <span>12h</span></label></div></div>
        <div class="row-flex"><div class="col"><div class="settings-title">Clock position</div><div class="desc">Where to place the clock.</div></div><div class="radio-group" id="sbClockPos"><label class="radio"><input type="radio" name="sbpos" value="center" checked> <span>Center</span></label><label class="radio"><input type="radio" name="sbpos" value="top"> <span>Top</span></label><label class="radio"><input type="radio" name="sbpos" value="bottom"> <span>Bottom</span></label></div></div>
      </div></section>
      <section class="section" data-sec="advanced"><div class="section-title"><span>Advanced</span></div><div class="section-content">
        <div class="row-flex"><div class="col"><div class="settings-title">Show advanced options</div><div class="desc">Enable extra controls below.</div></div><label class="switch"><input type="checkbox" id="advEnable" /><span class="knob"></span></label></div>
        <div id="advBody">
          <div class="row-flex"><div class="col"><div class="settings-title">Save preferences automatically</div><div class="desc">Keep your choices between visits.</div></div><label class="switch"><input type="checkbox" id="autosaveInput" /><span class="knob"></span></label></div>
          <div class="row-flex"><div class="col"><div class="settings-title">Performance mode</div><div class="desc">Reduce animations and CPU usage.</div></div><label class="switch"><input type="checkbox" id="perfInput" /><span class="knob"></span></label></div>
          <div class="row-flex"><div class="col"><div class="settings-title">Auto update interval</div><div class="desc">Refresh countdown more often.</div></div><div class="radio-group" id="refreshGroup"><label class="radio"><input type="radio" name="refresh" value="1000" checked> <span>1s</span></label><label class="radio"><input type="radio" name="refresh" value="500"> <span>0.5s</span></label><label class="radio"><input type="radio" name="refresh" value="2000"> <span>2s</span></label></div></div>
          <div class="row-flex" style="justify-content:flex-end;gap:8px"><button class="icon-btn" id="exportBtn">Export settings</button><label class="icon-btn" for="importFile" style="cursor:pointer">Import settings</label><input type="file" id="importFile" accept="application/json" style="display:none" /></div>
        </div>
        <div class="row-flex" style="justify-content:flex-end;gap:8px"><button class="icon-btn" id="resetBtn">Reset</button></div>
      </div></section>
    </div>
  </div>
</div>
<script>
const PREFS_KEY="xmas-widget-prefs";
const DEFAULTS={langId:"en",theme:"light",design:"default",glassBlur:true,dir:"auto",ui:"en",autoDetect:true,advancedDetect:true,fallback:"smart",showCountdown:true,weekday:false,longMonth:false,uiAnim:false,snow:false,panelStyle:"minimal",mobileStyle:"classic",accessible:false,autosave:true,perf:false,refresh:1000,xmasEve:false,newYear:false,customDate:"",countfmt:"full",countstyle:"normal",loading:false,trStyle:"B",advEnabled:false,standbyEnabled:false,sbStyle:"minimal",sbOnlyCountdown:true,sbNoAnim:true,sbDark:true,sbAuto:false,sbIdleMins:10,sbSleepMins:0,sbClock:false,sbClock12:false,sbClockPos:"center",_initialized:false};
const LANGS=[{id:"en",label:"English",locale:"en-GB",tz:"Europe/London",city:"London"},{id:"it",label:"Italiano",locale:"it-IT",tz:"Europe/Rome",city:"Roma"},{id:"es",label:"Español",locale:"es-ES",tz:"Europe/Madrid",city:"Madrid"},{id:"fr",label:"Français",locale:"fr-FR",tz:"Europe/Paris",city:"Paris"},{id:"de",label:"Deutsch",locale:"de-DE",tz:"Europe/Berlin",city:"Berlin"},{id:"pt",label:"Português",locale:"pt-PT",tz:"Europe/Lisbon",city:"Lisboa"},{id:"pl",label:"Polski",locale:"pl-PL",tz:"Europe/Warsaw",city:"Warszawa"},{id:"us",label:"English (US)",locale:"en-US",tz:"America/New_York",city:"New York"},{id:"ja",label:"日本語",locale:"ja-JP",tz:"Asia/Tokyo",city:"東京"},{id:"bg",label:"Български",locale:"bg-BG",tz:"Europe/Sofia",city:"Sofia"},{id:"cs",label:"Čeština",locale:"cs-CZ",tz:"Europe/Prague",city:"Praha"},{id:"da",label:"Dansk",locale:"da-DK",tz:"Europe/Copenhagen",city:"København"},{id:"nl",label:"Nederlands",locale:"nl-NL",tz:"Europe/Amsterdam",city:"Amsterdam"},{id:"et",label:"Eesti",locale:"et-EE",tz:"Europe/Tallinn",city:"Tallinn"},{id:"fi",label:"Suomi",locale:"fi-FI",tz:"Europe/Helsinki",city:"Helsinki"},{id:"el",label:"Ελληνικά",locale:"el-GR",tz:"Europe/Athens",city:"Αθήνα"},{id:"hu",label:"Magyar",locale:"hu-HU",tz:"Europe/Budapest",city:"Budapest"},{id:"is",label:"Íslenska",locale:"is-IS",tz:"Atlantic/Reykjavik",city:"Reykjavík"},{id:"ga",label:"Gaeilge",locale:"ga-IE",tz:"Europe/Dublin",city:"Dublin"},{id:"lv",label:"Latviešu",locale:"lv-LV",tz:"Europe/Riga",city:"Rīga"},{id:"lt",label:"Lietuvių",locale:"lt-LT",tz:"Europe/Vilnius",city:"Vilnius"},{id:"no",label:"Norsk",locale:"nb-NO",tz:"Europe/Oslo",city:"Oslo"},{id:"pt-br",label:"Português (Brasil)",locale:"pt-BR",tz:"America/Sao_Paulo",city:"São Paulo"},{id:"ro",label:"Română",locale:"ro-RO",tz:"Europe/Bucharest",city:"București"},{id:"ru",label:"Русский",locale:"ru-RU",tz:"Europe/Moscow",city:"Москва"},{id:"sk",label:"Slovenčina",locale:"sk-SK",tz:"Europe/Bratislava",city:"Bratislava"},{id:"sl",label:"Slovenščina",locale:"sl-SI",tz:"Europe/Ljubljana",city:"Ljubljana"},{id:"sq",label:"Shqip",locale:"sq-AL",tz:"Europe/Tirane",city:"Tiranë"},{id:"sr",label:"Српски",locale:"sr-RS",tz:"Europe/Belgrade",city:"Beograd"},{id:"sv",label:"Svenska",locale:"sv-SE",tz:"Europe/Stockholm",city:"Stockholm"},{id:"tr",label:"Türkçe",locale:"tr-TR",tz:"Europe/Istanbul",city:"İstanbul"},{id:"uk",label:"Українська",locale:"uk-UA",tz:"Europe/Kyiv",city:"Київ"},{id:"hr",label:"Hrvatski",locale:"hr-HR",tz:"Europe/Zagreb",city:"Zagreb"},{id:"ca",label:"Català",locale:"ca-ES",tz:"Europe/Madrid",city:"Barcelona"},{id:"eu",label:"Euskara",locale:"eu-ES",tz:"Europe/Madrid",city:"Bilbo"},{id:"gl",label:"Galego",locale:"gl-ES",tz:"Europe/Madrid",city:"Santiago"},{id:"es-mx",label:"Español (México)",locale:"es-MX",tz:"America/Mexico_City",city:"Ciudad de México"},{id:"es-ar",label:"Español (Argentina)",locale:"es-AR",tz:"America/Argentina/Buenos_Aires",city:"Buenos Aires"},{id:"es-cl",label:"Español (Chile)",locale:"es-CL",tz:"America/Santiago",city:"Santiago"},{id:"en-ca",label:"English (Canada)",locale:"en-CA",tz:"America/Toronto",city:"Toronto"},{id:"en-au",label:"English (Australia)",locale:"en-AU",tz:"Australia/Sydney",city:"Sydney"},{id:"en-nz",label:"English (New Zealand)",locale:"en-NZ",tz:"Pacific/Auckland",city:"Auckland"},{id:"zh",label:"中文",locale:"zh-CN",tz:"Asia/Shanghai",city:"上海"},{id:"ko",label:"한국어",locale:"ko-KR",tz:"Asia/Seoul",city:"서울"},{id:"hi",label:"हिन्दी",locale:"hi-IN",tz:"Asia/Kolkata",city:"Kolkata"},{id:"ar-sa",label:"العربية (Saudi Arabia)",locale:"ar-SA",tz:"Asia/Riyadh",city:"الرياض"},{id:"ar-eg",label:"العربية (Egypt)",locale:"ar-EG",tz:"Africa/Cairo",city:"القاهرة"},{id:"th",label:"ไทย",locale:"th-TH",tz:"Asia/Bangkok",city:"กรุงเทพฯ"},{id:"id",label:"Bahasa Indonesia",locale:"id-ID",tz:"Asia/Jakarta",city:"Jakarta"},{id:"ms",label:"Bahasa Melayu",locale:"ms-MY",tz:"Asia/Kuala_Lumpur",city:"Kuala Lumpur"},{id:"vi",label:"Tiếng Việt",locale:"vi-VN",tz:"Asia/Ho_Chi_Minh",city:"Hồ Chí Minh"},{id:"fa",label:"فارسی",locale:"fa-IR",tz:"Asia/Tehran",city:"تهران"},{id:"he",label:"עברית",locale:"he-IL",tz:"Asia/Jerusalem",city:"ירושלים"},{id:"bn",label:"বাংলা",locale:"bn-BD",tz:"Asia/Dhaka",city:"Dhaka"},{id:"ur",label:"اردو",locale:"ur-PK",tz:"Asia/Karachi",city:"Karachi"},{id:"sw",label:"Kiswahili",locale:"sw-KE",tz:"Africa/Nairobi",city:"Nairobi"},{id:"af",label:"Afrikaans",locale:"af-ZA",tz:"Africa/Johannesburg",city:"Johannesburg"},{id:"am",label:"አማርኛ",locale:"am-ET",tz:"Africa/Addis_Ababa",city:"Addis Ababa"}];
const collator=new Intl.Collator(undefined,{sensitivity:"base"});LANGS.sort((a,b)=>collator.compare(a.label,b.label));
const UI={en:{settings:"Settings",appearance:"Appearance",themeTitle:"Theme",themeDesc:"Switch between Light and Dark.",designTitle:"Design style",designDesc:"Choose the visual style of the app.",designDefault:"Default",designPro:"Professional",designGlass:"Glass",glassTitle:"Glass blur",glassDesc:"Enable blur effect for the glass theme.",autoDetect:"Auto-detect device language",autoDetectDesc:"Use your device language at first visit.",advancedDetect:"Advanced detection (browser priority)",advancedDetectDesc:"Check navigator.languages in order.",fallbackTitle:"Fallback strategy",fallbackDesc:"When your language isn’t available.",fallbackSmart:"Smart (similar)",uiLangTitle:"Interface language",uiLangDesc:"Texts of the interface only.",menuSection:"Language menu",dirTitle:"Open direction",dirDesc:"Down, Up or Auto.",dirAuto:"Auto",dirDown:"Down",dirUp:"Up",countSection:"Countdown",countToggle:"Show countdown",countToggleDesc:"If off, only the answer will be shown.",a11ySection:"Accessibility",systemSection:"Advanced",title:"Is it Christmas?",yes:"Yes, it's Christmas.",no:"Not yet.",today:(city,d)=>`Today in ${city} it's ${d}.`,countdown:(d,h,m,s,fmt)=>fmt==="days"?`Only ${d} days until Christmas.`:`Only ${d} days, ${h}:${m}:${s} until Christmas.`,tzInfo:(tz)=>`Time zone: ${tz}`,search:"Search language...",noResults:"No results",translations:"Translations",trLabel:"Translation style",trDesc:"Choose how strictly texts are localized.",trA:"Full local",trB:"Modern",standby:"Standby mode",close:"Close",exit:"Exit",settingsBtn:"Settings"},it:{settings:"Impostazioni",appearance:"Aspetto",themeTitle:"Tema",themeDesc:"Passa tra Chiaro e Scuro.",designTitle:"Design",designDesc:"Scegli lo stile visivo dell’app.",designDefault:"Default",designPro:"Professionale",designGlass:"Glass",glassTitle:"Sfocatura Glass",glassDesc:"Abilita il blur per il tema glass.",autoDetect:"Rileva lingua dispositivo",autoDetectDesc:"Usa la lingua del dispositivo al primo accesso.",advancedDetect:"Rilevamento avanzato (priorità browser)",advancedDetectDesc:"Controlla navigator.languages in ordine.",fallbackTitle:"Strategia di fallback",fallbackDesc:"Quando la tua lingua non è disponibile.",fallbackSmart:"Smart (simile)",uiLangTitle:"Lingua interfaccia",uiLangDesc:"Solo i testi dell’interfaccia.",menuSection:"Menu lingue",dirTitle:"Direzione apertura",dirDesc:"In basso, in alto o automatico.",dirAuto:"Automatico",dirDown:"In basso",dirUp:"In alto",countSection:"Countdown",countToggle:"Mostra countdown",countToggleDesc:"Se disattivo, mostra solo la risposta.",a11ySection:"Accessibilità",systemSection:"Avanzate",title:"È Natale?",yes:"Sì, è Natale.",no:"Non ancora.",today:(city,d)=>`Oggi a ${city} è ${d}.`,countdown:(d,h,m,s,fmt)=>fmt==="days"?`Mancano ${d} giorni a Natale.`:`Mancano ${d} giorni, ${h}:${m}:${s} a Natale.`,tzInfo:(tz)=>`Fuso orario: ${tz}`,search:"Cerca lingua...",noResults:"Nessun risultato",translations:"Traduzioni",trLabel:"Stile di traduzione",trDesc:"Quanto vuoi che i testi siano localizzati.",trA:"Locale puro",trB:"Moderno",standby:"Modalità Standby",close:"Chiudi",exit:"Esci",settingsBtn:"Impostazioni"},es:{settings:"Ajustes",appearance:"Apariencia",themeTitle:"Tema",themeDesc:"Cambia entre Claro y Oscuro.",designTitle:"Diseño",designDesc:"Elige el estilo visual.",designDefault:"Predeterminado",designPro:"Profesional",designGlass:"Glass",glassTitle:"Desenfoque Glass",glassDesc:"Activa el blur para el tema glass.",autoDetect:"Detectar idioma del dispositivo",autoDetectDesc:"Usar el idioma del dispositivo la primera vez.",advancedDetect:"Detección avanzada (prioridad del navegador)",advancedDetectDesc:"Usa navigator.languages en orden.",fallbackTitle:"Estrategia de fallback",fallbackDesc:"Cuando tu idioma no está disponible.",fallbackSmart:"Inteligente (similar)",uiLangTitle:"Idioma de la interfaz",uiLangDesc:"Solo los textos de la interfaz.",menuSection:"Menú de idiomas",dirTitle:"Dirección de apertura",dirDesc:"Abajo, Arriba o Auto.",dirAuto:"Automático",dirDown:"Abajo",dirUp:"Arriba",countSection:"Cuenta regresiva",countToggle:"Mostrar cuenta regresiva",countToggleDesc:"Si está apagado, solo se mostrará la respuesta.",a11ySection:"Accesibilidad",systemSection:"Avanzado",title:"¿Es Navidad?",yes:"Sí, es Navidad.",no:"Todavía no.",today:(city,d)=>`Hoy en ${city} es ${d}.`,countdown:(d,h,m,s,fmt)=>fmt==="days"?`Faltan ${d} días para Navidad.`:`Faltan ${d} días, ${h}:${m}:${s} para Navidad.`,tzInfo:(tz)=>`Huso horario: ${tz}`,search:"Buscar idioma...",noResults:"Sin resultados",translations:"Traducciones",trLabel:"Estilo de traducción",trDesc:"Qué tan estricta es la localización.",trA:"Local completo",trB:"Moderno",standby:"Modo standby",close:"Cerrar",exit:"Salir",settingsBtn:"Ajustes"},fr:{settings:"Paramètres",appearance:"Apparence",themeTitle:"Thème",themeDesc:"Basculer entre Clair et Sombre.",designTitle:"Design",designDesc:"Choisissez le style visuel.",designDefault:"Défaut",designPro:"Professionnel",designGlass:"Glass",glassTitle:"Flou Glass",glassDesc:"Activer le flou pour le thème glass.",autoDetect:"Détecter la langue de l'appareil",autoDetectDesc:"Utiliser la langue de l’appareil lors de la première visite.",advancedDetect:"Détection avancée (priorité du navigateur)",advancedDetectDesc:"Vérifie navigator.languages dans l'ordre.",fallbackTitle:"Stratégie de repli",fallbackDesc:"Quand votre langue n’est pas disponible.",fallbackSmart:"Intelligent (similaire)",uiLangTitle:"Langue de l'interface",uiLangDesc:"Textes de l'interface uniquement.",menuSection:"Menu des langues",dirTitle:"Direction d'ouverture",dirDesc:"Bas, Haut ou Auto.",dirAuto:"Auto",dirDown:"Bas",dirUp:"Haut",countSection:"Compte à rebours",countToggle:"Afficher le compte à rebours",countToggleDesc:"Si désactivé, seule la réponse s'affiche.",a11ySection:"Accessibilité",systemSection:"Avancé",title:"Est-ce Noël ?",yes:"Oui, c'est Noël.",no:"Pas encore.",today:(city,d)=>`Aujourd'hui à ${city}, nous sommes le ${d}.`,countdown:(d,h,m,s,fmt)=>fmt==="days"?`Il reste ${d} jours avant Noël.`:`Il reste ${d} jours, ${h}:${m}:${s} avant Noël.`,tzInfo:(tz)=>`Fuseau horaire : ${tz}`,search:"Rechercher une langue...",noResults:"Aucun résultat",translations:"Traductions",trLabel:"Style de traduction",trDesc:"Degré de localisation des textes.",trA:"Local complet",trB:"Moderne",standby:"Mode veille",close:"Fermer",exit:"Quitter",settingsBtn:"Paramètres"},de:{settings:"Einstellungen",appearance:"Erscheinungsbild",themeTitle:"Thema",themeDesc:"Zwischen Hell und Dunkel wechseln.",designTitle:"Design",designDesc:"Visuellen Stil wählen.",designDefault:"Standard",designPro:"Professionell",designGlass:"Glass",glassTitle:"Glass-Weichzeichnung",glassDesc:"Blur-Effekt für Glass-Theme aktivieren.",autoDetect:"Sprache des Geräts erkennen",autoDetectDesc:"Beim ersten Besuch Gerätesprache verwenden.",advancedDetect:"Erweiterte Erkennung (Browser-Priorität)",advancedDetectDesc:"navigator.languages der Reihe nach prüfen.",fallbackTitle:"Fallback-Strategie",fallbackDesc:"Wenn deine Sprache nicht verfügbar ist.",fallbackSmart:"Smart (ähnlich)",uiLangTitle:"Interface-Sprache",uiLangDesc:"Nur UI-Texte.",menuSection:"Sprachmenü",dirTitle:"Öffnungsrichtung",dirDesc:"Unten, Oben oder Auto.",dirAuto:"Auto",dirDown:"Unten",dirUp:"Oben",countSection:"Countdown",countToggle:"Countdown anzeigen",countToggleDesc:"Wenn aus, nur Antwort.",a11ySection:"Barrierefreiheit",systemSection:"Erweitert",title:"Ist Weihnachten?",yes:"Ja, es ist Weihnachten.",no:"Noch nicht.",today:(city,d)=>`Heute in ${city} ist der ${d}.`,countdown:(d,h,m,s,fmt)=>fmt==="days"?`Es sind noch ${d} Tage bis Weihnachten.`:`Es sind noch ${d} Tage, ${h}:${m}:${s} bis Weihnachten.`,tzInfo:(tz)=>`Zeitzone: ${tz}`,search:"Sprache suchen...",noResults:"Keine Ergebnisse",translations:"Übersetzungen",trLabel:"Übersetzungsstil",trDesc:"Wie strikt lokalisiert werden soll.",trA:"Voll lokal",trB:"Modern",standby:"Standby-Modus",close:"Schließen",exit:"Beenden",settingsBtn:"Einstellungen"}};
const AVAILABLE_UI=["en","it","es","fr","de"];
const load=()=>{try{return {...DEFAULTS,...(JSON.parse(localStorage.getItem(PREFS_KEY))||{})}}catch{return {...DEFAULTS}}};
const save=p=>{if(p.autosave!==false)localStorage.setItem(PREFS_KEY,JSON.stringify(p))};
const resetPrefs=()=>{localStorage.removeItem(PREFS_KEY);return {...DEFAULTS}};
let prefs=load();
const pad=n=>String(n).padStart(2,"0");
function getYMDInTZ(tz,locale,date=new Date()){const fmt=new Intl.DateTimeFormat(locale,{timeZone:tz,year:"numeric",month:"numeric",day:"numeric"});const parts=fmt.formatToParts(date);const val=t=>+parts.find(p=>p.type===t).value;return {y:val("year"),m:val("month"),d:val("day")}}
function getTZOffsetMinutes(tz,date){const s=new Intl.DateTimeFormat("en-GB",{timeZone:tz,hour:"2-digit",minute:"2-digit",timeZoneName:"shortOffset"}).format(date);const m=s.match(/GMT([+-])(\d{2}):?(\d{2})?/);if(!m)return 0;const sign=m[1]==="-"?-1:1,hh=+m[2],mm=+(m[3]||0);return sign*(hh*60+mm)}
function getChristmasUTCInstant(tz,year){const offMin=getTZOffsetMinutes(tz,new Date(Date.UTC(year,11,25,0,0,0)));return new Date(Date.UTC(year,11,25,0,0,0)-offMin*60000)}
function isChristmasInTZ(tz,locale,date=new Date()){const {m,d}=getYMDInTZ(tz,locale,date);return m===12&&d===25}
const dropdown=document.getElementById("langDropdown");const btn=document.getElementById("dropdownButton");const labelEl=document.getElementById("dropdownLabel");const searchInput=document.getElementById("searchInput");const list=document.getElementById("list");
const openSettingsBtn=document.getElementById("openSettingsBtn");const settingsOverlay=document.getElementById("settingsOverlay");const closeSettingsBtn=document.getElementById("closeSettingsBtn");
const themeInput=document.getElementById("themeInput");const designGroup=document.getElementById("designGroup");const glassRow=document.getElementById("glassRow");const glassBlurInput=document.getElementById("glassBlurInput");const uiAnimInput=document.getElementById("uiAnimInput");const panelStyleGroup=document.getElementById("panelStyleGroup");const snowInput=document.getElementById("snowInput");const mobileStyleGroup=document.getElementById("mobileStyleGroup");
const autoDetectInput=document.getElementById("autoDetectInput");const advancedDetectInput=document.getElementById("advancedDetectInput");const fallbackGroup=document.getElementById("fallbackGroup");const uiLangSelect=document.getElementById("uiLangSelect");const weekdayInput=document.getElementById("weekdayInput");const longMonthInput=document.getElementById("longMonthInput");
const dirGroup=document.getElementById("dirGroup");
const elTitle=document.getElementById("title");const elToday=document.getElementById("today");const elAnswer=document.getElementById("answer");const elCountdown=document.getElementById("countdown");const elTzInfo=document.getElementById("tzInfo");
const countdownInput=document.getElementById("countdownInput");const xmasEveInput=document.getElementById("xmasEveInput");const newYearInput=document.getElementById("newYearInput");const customDateInput=document.getElementById("customDateInput");const countFormatGroup=document.getElementById("countFormatGroup");const countStyleGroup=document.getElementById("countStyleGroup");const loadingInput=document.getElementById("loadingInput");
const autosaveInput=document.getElementById("autosaveInput");const perfInput=document.getElementById("perfInput");const refreshGroup=document.getElementById("refreshGroup");const exportBtn=document.getElementById("exportBtn");const importFile=document.getElementById("importFile");const resetBtn=document.getElementById("resetBtn");
const loadingOverlay=document.getElementById("loadingOverlay");const snowCanvas=document.getElementById("snowCanvas");
const advEnable=document.getElementById("advEnable");const advBody=document.getElementById("advBody");
const sbEnable=document.getElementById("sbEnable");const sbStyleGroup=document.getElementById("sbStyleGroup");const sbOnlyCountdown=document.getElementById("sbOnlyCountdown");const sbNoAnim=document.getElementById("sbNoAnim");const sbDark=document.getElementById("sbDark");const sbAuto=document.getElementById("sbAuto");const sbIdleMins=document.getElementById("sbIdleMins");const sbSleepMins=document.getElementById("sbSleepMins");const sbClock=document.getElementById("sbClock");const sbClockFmt=document.getElementById("sbClockFmt");const sbClockPos=document.getElementById("sbClockPos");
const trStyleGroup=document.getElementById("trStyleGroup");const standbyLayer=document.getElementById("standbyLayer");const standbyMain=document.getElementById("standbyMain");const standbyClock=document.getElementById("standbyClock");const standbyExit=document.getElementById("standbyExit");
let snowCtx=null;let snowflakes=[];let idleTimer=null;let sleepTimer=null;let clockTick=null;let snowBeforeStandby=false;
function T(){const base=UI[prefs.ui]||UI.en;return base}
function applyUIText(){document.querySelector('#settingsTitle').textContent=T().settings;document.getElementById('closeSettingsBtn').textContent=T().close;openSettingsBtn.textContent=T().settingsBtn;document.querySelector('[data-sec="appearance"] .section-title span').textContent=T().appearance;document.querySelector('[data-sec="language"] .section-title span').textContent="Language";document.querySelector('[data-sec="langmenu"] .section-title span').textContent=T().menuSection;document.querySelector('[data-sec="countdown"] .section-title span').textContent=T().countSection;document.querySelector('[data-sec="a11y"] .section-title span').textContent=T().a11ySection;document.querySelector('[data-sec="advanced"] .section-title span').textContent=T().systemSection;document.querySelector('[data-sec="translations"] .section-title span').textContent=T().translations;document.querySelector('[data-sec="standby"] .section-title span').textContent=T().standby;document.getElementById('trStyleLabel').textContent=T().trLabel;document.getElementById('trStyleDesc').textContent=T().trDesc;document.querySelector('#trStyleGroup label:nth-child(1) span').textContent=T().trB;document.querySelector('#trStyleGroup label:nth-child(2) span').textContent=T().trA;document.querySelector('[data-i18n="themeTitle"]').textContent=T().themeTitle;document.querySelector('[data-i18n="themeDesc"]').textContent=T().themeDesc;document.querySelector('[data-i18n="designTitle"]').textContent=T().designTitle;document.querySelector('[data-i18n="designDesc"]').textContent=T().designDesc;designGroup.querySelector('label:nth-child(1) span').textContent=T().designDefault;designGroup.querySelector('label:nth-child(2) span').textContent=T().designPro;designGroup.querySelector('label:nth-child(3) span').textContent=T().designGlass;document.querySelector('[data-i18n="glassTitle"]').textContent=T().glassTitle;document.querySelector('[data-i18n="glassDesc"]').textContent=T().glassDesc;document.querySelector('[data-i18n="autoDetect"]').textContent=T().autoDetect;document.querySelector('[data-i18n="autoDetectDesc"]').textContent=T().autoDetectDesc;document.querySelector('[data-i18n="advancedDetect"]').textContent=T().advancedDetect;document.querySelector('[data-i18n="advancedDetectDesc"]').textContent=T().advancedDetectDesc;document.querySelector('[data-i18n="fallbackTitle"]').textContent=T().fallbackTitle;document.querySelector('[data-i18n="fallbackDesc"]').textContent=T().fallbackDesc;document.querySelector('[data-i18n="uiLangTitle"]').textContent=T().uiLangTitle;document.querySelector('[data-i18n="uiLangDesc"]').textContent=T().uiLangDesc;document.querySelector('[data-i18n="dirTitle"]').textContent=T().dirTitle;document.querySelector('[data-i18n="dirDesc"]').textContent=T().dirDesc;document.querySelector('#dirGroup label:nth-child(1) span').textContent=T().dirAuto;document.querySelector('#dirGroup label:nth-child(2) span').textContent=T().dirDown;document.querySelector('#dirGroup label:nth-child(3) span').textContent=T().dirUp;document.getElementById("standbyExit").textContent=T().exit;searchInput.placeholder=T().search}
const currentLang=()=>LANGS.find(l=>l.id===prefs.langId)||LANGS.find(l=>l.id==="en");
function setDropdownLabel(lang){labelEl.textContent=`${lang.label} — ${lang.tz}`}
function renderList(filter=""){const f=filter.trim().toLowerCase();list.innerHTML="";const items=LANGS.filter(l=>!f||l.label.toLowerCase().includes(f)||l.tz.toLowerCase().includes(f));items.forEach(lang=>{const b=document.createElement("button");b.className="item";b.setAttribute("role","option");b.innerHTML=`<span>${lang.label}</span><span class="muted">${lang.tz}</span>`;b.addEventListener("click",()=>{prefs.langId=lang.id;save(prefs);setDropdownLabel(lang);document.getElementById("langDropdown").classList.remove("open","up","down");btn.setAttribute("aria-expanded","false");updateAll()});list.appendChild(b)});if(items.length===0){const empty=document.createElement("div");empty.className="muted";empty.style.padding="10px 12px";empty.textContent=T().noResults;list.appendChild(empty)}}
function computeMenuDirection(){const pref=prefs.dir;if(pref==="up"||pref==="down")return pref;const rect=document.getElementById("langDropdown").getBoundingClientRect();const spaceBelow=window.innerHeight-rect.bottom;const spaceAbove=rect.top;const desired=Math.min(window.innerHeight*0.6,420);return (spaceBelow>=desired||spaceBelow>=spaceAbove)?"down":"up"}
document.getElementById("dropdownButton").addEventListener("click",e=>{e.stopPropagation();const dd=document.getElementById("langDropdown");const willOpen=!dd.classList.contains("open");dd.classList.toggle("open");const dir=computeMenuDirection();dd.classList.toggle("up",willOpen&&dir==="up");dd.classList.toggle("down",willOpen&&dir==="down");document.getElementById("dropdownButton").setAttribute("aria-expanded",String(willOpen));if(willOpen){renderList("");searchInput.value="";setTimeout(()=>searchInput.focus(),0)}});document.addEventListener("click",e=>{if(!document.getElementById("langDropdown").contains(e.target))document.getElementById("langDropdown").classList.remove("open","up","down")});
searchInput.addEventListener("input",e=>renderList(e.target.value));searchInput.addEventListener("keydown",e=>{if(e.key==="Escape"){searchInput.value="";renderList("");e.stopPropagation()}});
openSettingsBtn.addEventListener("click",()=>{settingsOverlay.classList.add("open");settingsOverlay.setAttribute("aria-hidden","false")});closeSettingsBtn.addEventListener("click",()=>{settingsOverlay.classList.remove("open");settingsOverlay.setAttribute("aria-hidden","true")});settingsOverlay.addEventListener("click",e=>{if(e.target===settingsOverlay){settingsOverlay.classList.remove("open");settingsOverlay.setAttribute("aria-hidden","true")}});
document.querySelectorAll(".section-title").forEach(title=>{title.addEventListener("click",()=>{const sec=title.parentElement;document.querySelectorAll(".section").forEach(s=>{if(s!==sec)s.classList.remove("open")});sec.classList.toggle("open")})});
function initSettingsControls(){themeInput.checked=(prefs.theme==="dark");[...designGroup.querySelectorAll('input[name="design"]')].forEach(r=>r.checked=(r.value===prefs.design));glassRow.style.display=prefs.design==="glass"?"":"none";glassBlurInput.checked=!!prefs.glassBlur;uiAnimInput.checked=!!prefs.uiAnim;[...panelStyleGroup.querySelectorAll('input[name="panelstyle"]')].forEach(r=>r.checked=(r.value===prefs.panelStyle));snowInput.checked=!!prefs.snow;[...mobileStyleGroup.querySelectorAll('input[name="mobile"]')].forEach(r=>r.checked=(r.value===prefs.mobileStyle));autoDetectInput.checked=!!prefs.autoDetect;advancedDetectInput.checked=!!prefs.advancedDetect;[...fallbackGroup.querySelectorAll('input[name="fallback"]')].forEach(r=>r.checked=(r.value===prefs.fallback));uiLangSelect.value=prefs.ui;weekdayInput.checked=!!prefs.weekday;longMonthInput.checked=!!prefs.longMonth;[...dirGroup.querySelectorAll('input[name="dir"]')].forEach(r=>r.checked=(r.value===prefs.dir));countdownInput.checked=!!prefs.showCountdown;xmasEveInput.checked=!!prefs.xmasEve;newYearInput.checked=!!prefs.newYear;customDateInput.value=prefs.customDate||"";[...countFormatGroup.querySelectorAll('input[name="countfmt"]')].forEach(r=>r.checked=(r.value===prefs.countfmt));[...countStyleGroup.querySelectorAll('input[name="countstyle"]')].forEach(r=>r.checked=(r.value===prefs.countstyle));loadingInput.checked=!!prefs.loading;autosaveInput.checked=prefs.autosave!==false;perfInput.checked=!!prefs.perf;[...refreshGroup.querySelectorAll('input[name="refresh"]')].forEach(r=>r.checked=(String(r.value)===String(prefs.refresh)));[...trStyleGroup.querySelectorAll('input[name="trstyle"]')].forEach(r=>r.checked=(r.value===prefs.trStyle));advEnable.checked=!!prefs.advEnabled;advBody.style.display=prefs.advEnabled?"block":"none";sbEnable.checked=!!prefs.standbyEnabled;[...sbStyleGroup.querySelectorAll('input[name="sbstyle"]')].forEach(r=>r.checked=(r.value===prefs.sbStyle));sbOnlyCountdown.checked=!!prefs.sbOnlyCountdown;sbNoAnim.checked=!!prefs.sbNoAnim;sbDark.checked=!!prefs.sbDark;sbAuto.checked=!!prefs.sbAuto;sbIdleMins.value=String(prefs.sbIdleMins);sbSleepMins.value=String(prefs.sbSleepMins);sbClock.checked=!!prefs.sbClock;[...sbClockFmt.querySelectorAll('input[name="sbfmt"]')].forEach(r=>r.checked=(r.value===(prefs.sbClock12?"12":"24")));[...sbClockPos.querySelectorAll('input[name="sbpos"]')].forEach(r=>r.checked=(r.value===prefs.sbClockPos))}
themeInput.addEventListener("change",()=>{prefs.theme=themeInput.checked?"dark":"light";save(prefs);applyTheme()});
designGroup.addEventListener("change",e=>{if(e.target.name==="design"){prefs.design=e.target.value;save(prefs);applyDesign();glassRow.style.display=prefs.design==="glass"?"":"none"}});
glassBlurInput.addEventListener("change",()=>{prefs.glassBlur=!!glassBlurInput.checked;save(prefs);applyDesign()});
uiAnimInput.addEventListener("change",()=>{prefs.uiAnim=!!uiAnimInput.checked;save(prefs);document.body.style.transition=prefs.uiAnim?"background-color .25s ease,color .25s ease,border-color .25s ease,backdrop-filter .25s ease":"none"});
panelStyleGroup.addEventListener("change",e=>{if(e.target.name==="panelstyle"){prefs.panelStyle=e.target.value;save(prefs);document.documentElement.setAttribute("data-panel-style",prefs.panelStyle)}});
snowInput.addEventListener("change",()=>{prefs.snow=!!snowInput.checked;save(prefs);toggleSnow(prefs.snow)});
mobileStyleGroup.addEventListener("change",e=>{if(e.target.name==="mobile"){prefs.mobileStyle=e.target.value;save(prefs);document.documentElement.setAttribute("data-mobile",prefs.mobileStyle)}});
autoDetectInput.addEventListener("change",()=>{prefs.autoDetect=!!autoDetectInput.checked;save(prefs)});
advancedDetectInput.addEventListener("change",()=>{prefs.advancedDetect=!!advancedDetectInput.checked;save(prefs)});
fallbackGroup.addEventListener("change",e=>{if(e.target.name==="fallback"){prefs.fallback=e.target.value;save(prefs)}});
uiLangSelect.addEventListener("change",()=>{prefs.ui=uiLangSelect.value;save(prefs);applyUIText();updateAll();document.documentElement.lang=prefs.ui});
trStyleGroup.addEventListener("change",e=>{if(e.target.name==="trstyle"){prefs.trStyle=e.target.value;save(prefs);applyUIText()}});
weekdayInput.addEventListener("change",()=>{prefs.weekday=!!weekdayInput.checked;save(prefs);updateAll()});
longMonthInput.addEventListener("change",()=>{prefs.longMonth=!!longMonthInput.checked;save(prefs);updateAll()});
dirGroup.addEventListener("change",e=>{if(e.target.name==="dir"){prefs.dir=e.target.value;save(prefs)}});
countdownInput.addEventListener("change",()=>{prefs.showCountdown=!!countdownInput.checked;save(prefs);updateCountdown()});
xmasEveInput.addEventListener("change",()=>{prefs.xmasEve=!!xmasEveInput.checked;save(prefs)});
newYearInput.addEventListener("change",()=>{prefs.newYear=!!newYearInput.checked;save(prefs)});
customDateInput.addEventListener("change",()=>{prefs.customDate=customDateInput.value;save(prefs)});
countFormatGroup.addEventListener("change",e=>{if(e.target.name==="countfmt"){prefs.countfmt=e.target.value;save(prefs)}});
countStyleGroup.addEventListener("change",e=>{if(e.target.name==="countstyle"){prefs.countstyle=e.target.value;save(prefs);applyCountStyle()}});
loadingInput.addEventListener("change",()=>{prefs.loading=!!loadingInput.checked;save(prefs)});
autosaveInput.addEventListener("change",()=>{prefs.autosave=!!autosaveInput.checked;save(prefs)});
perfInput.addEventListener("change",()=>{prefs.perf=!!perfInput.checked;save(prefs)});
refreshGroup.addEventListener("change",e=>{if(e.target.name==="refresh"){prefs.refresh=Number(e.target.value);clearInterval(tick);tick=setInterval(updateAll,prefs.refresh);save(prefs)}});
exportBtn.addEventListener("click",()=>{const blob=new Blob([JSON.stringify(prefs,null,2)],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="settings.json";document.body.appendChild(a);a.click();a.remove()});
importFile.addEventListener("change",e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{try{const obj=JSON.parse(r.result);prefs={...DEFAULTS,...obj};save(prefs);applyTheme();applyDesign();applyUIText();initSettingsControls();setDropdownLabel(currentLang());updateAll()}catch{} };r.readAsText(f)});
resetBtn.addEventListener("click",()=>{prefs=resetPrefs();applyTheme();applyDesign();applyUIText();initSettingsControls();setDropdownLabel(currentLang());updateAll();document.documentElement.lang=prefs.ui});
advEnable.addEventListener("change",()=>{prefs.advEnabled=!!advEnable.checked;save(prefs);advBody.style.display=prefs.advEnabled?"block":"none"});
sbEnable.addEventListener("change",()=>{prefs.standbyEnabled=!!sbEnable.checked;save(prefs);applyStandbyState()});
sbStyleGroup.addEventListener("change",e=>{if(e.target.name==="sbstyle"){prefs.sbStyle=e.target.value;save(prefs);renderStandby()}})
sbOnlyCountdown.addEventListener("change",()=>{prefs.sbOnlyCountdown=!!sbOnlyCountdown.checked;save(prefs);renderStandby()});
sbNoAnim.addEventListener("change",()=>{prefs.sbNoAnim=!!sbNoAnim.checked;save(prefs);renderStandby()});
sbDark.addEventListener("change",()=>{prefs.sbDark=!!sbDark.checked;save(prefs);renderStandby()});
sbAuto.addEventListener("change",()=>{prefs.sbAuto=!!sbAuto.checked;save(prefs);setupIdleTimer()});
sbIdleMins.addEventListener("change",()=>{prefs.sbIdleMins=Number(sbIdleMins.value)||10;save(prefs);setupIdleTimer()});
sbSleepMins.addEventListener("change",()=>{prefs.sbSleepMins=Number(sbSleepMins.value)||0;save(prefs);applyStandbyState()});
sbClock.addEventListener("change",()=>{prefs.sbClock=!!sbClock.checked;save(prefs);renderStandby()});
sbClockFmt.addEventListener("change",e=>{if(e.target.name==="sbfmt"){prefs.sbClock12=(e.target.value==="12");save(prefs);renderStandby()}});
sbClockPos.addEventListener("change",e=>{if(e.target.name==="sbpos"){prefs.sbClockPos=e.target.value;save(prefs);renderStandby()}});
standbyExit.addEventListener("click",()=>{prefs.standbyEnabled=false;applyStandbyState()});
function applyTheme(){document.documentElement.setAttribute("data-theme",prefs.theme==="dark"?"dark":"light")}
function applyDesign(){document.documentElement.setAttribute("data-design",prefs.design);document.documentElement.setAttribute("data-glass-blur",String(!!prefs.glassBlur))}
function applyCountStyle(){elCountdown.style.fontSize=prefs.countstyle==="large"?"clamp(1.6rem,6vw,2.4rem)":prefs.countstyle==="minimal"?"1rem":"inherit";elCountdown.style.opacity=prefs.countstyle==="minimal"?"0.85":"1"}
function formatDateInTZ(lang){const opts={timeZone:lang.tz,year:"numeric",month:prefs.longMonth?"long":"2-digit",day:"2-digit"};if(prefs.weekday)opts.weekday="long";return new Intl.DateTimeFormat(lang.locale,opts).format(new Date())}
function updateTexts(){const lang=currentLang();const ui=T();const fDate=formatDateInTZ(lang);elTitle.textContent=ui.title;elToday.textContent=ui.today(lang.city,fDate);elTzInfo.textContent=ui.tzInfo(lang.tz);elAnswer.textContent=isChristmasInTZ(lang.tz,lang.locale)?ui.yes:ui.no}
function nextTargetInstant(lang){const now=new Date();const {y,m,d}=getYMDInTZ(lang.tz,lang.locale,now);let targets=[];targets.push(getChristmasUTCInstant(lang.tz,(m>12||(m===12&&d>25))?y+1:y));if(prefs.xmasEve){const off=getTZOffsetMinutes(lang.tz,new Date(Date.UTC(y,11,24,0,0,0)));targets.push(new Date(Date.UTC(y,11,24,0,0,0)-off*60000))}if(prefs.newYear){const off=getTZOffsetMinutes(lang.tz,new Date(Date.UTC(y+1,0,1,0,0,0)));targets.push(new Date(Date.UTC(y+1,0,1,0,0,0)-off*60000))}if(prefs.customDate){const cd=new Date(prefs.customDate+"T00:00:00");if(!isNaN(cd))targets.push(cd)}targets.sort((a,b)=>a-b);for(const t of targets){if(t>now)return t}return targets[0]||null}
function updateCountdown(){if(!prefs.showCountdown){elCountdown.textContent="";return}const lang=currentLang();const ui=T();const now=new Date();const target=nextTargetInstant(lang);if(!target){elCountdown.textContent="";return}const diff=target-now;if(diff<=0){elCountdown.textContent="";return}const days=Math.floor(diff/(1000*60*60*24));const hours=pad(Math.floor((diff/(1000*60*60))%24));const mins=pad(Math.floor((diff/(1000*60))%60));const secs=pad(Math.floor((diff/1000)%60));elCountdown.textContent=ui.countdown(days,hours,mins,secs,prefs.countfmt)}
function updateAll(){updateTexts();updateCountdown();if(prefs.standbyEnabled)renderStandby()}
function normalizeTag(tag){if(!tag)return "";return String(tag).toLowerCase().replace("_","-")}
function primarySubtag(tag){return normalizeTag(tag).split("-")[0]}
function pickUILangAuto(){const cands=[];if(prefs.advancedDetect&&Array.isArray(navigator.languages)&&navigator.languages.length){cands.push(...navigator.languages)}else{cands.push(navigator.language||"en")}for(const cand of cands){const p=primarySubtag(cand);if(AVAILABLE_UI.includes(p))return p;if(prefs.fallback==="smart"){if(p==="pt")return "es";if(["nl","el","tr","ru","uk","pl","ja","zh","ko","ar","fa","hi"].includes(p))return "en"}}return "en"}
function toggleSnow(on){if(on){snowCanvas.style.display="block";snowCanvas.width=innerWidth;snowCanvas.height=innerHeight;snowCtx=snowCanvas.getContext("2d");snowflakes=new Array(120).fill(0).map(()=>({x:Math.random()*snowCanvas.width,y:Math.random()*snowCanvas.height,r:Math.random()*2+1,s:Math.random()*0.7+0.3}));if(!snowLoop)startSnow()}else{snowCanvas.style.display="none";snowCtx=null;snowflakes=[]}}
let snowLoop=null;function startSnow(){if(snowLoop)return;snowLoop=()=>{if(!snowCtx){snowLoop=null;return}snowCtx.clearRect(0,0,snowCanvas.width,snowCanvas.height);snowCtx.fillStyle="rgba(255,255,255,.9)";snowflakes.forEach(f=>{snowCtx.beginPath();snowCtx.arc(f.x,f.y,f.r,0,Math.PI*2);snowCtx.fill();f.y+=f.s;f.x+=Math.sin(f.y*0.01)*0.3;if(f.y>snowCanvas.height){f.y=-5;f.x=Math.random()*snowCanvas.width}});requestAnimationFrame(snowLoop)};requestAnimationFrame(snowLoop)}
window.addEventListener("resize",()=>{if(snowCanvas.style.display==="block"){snowCanvas.width=innerWidth;snowCanvas.height=innerHeight}});
function openSection(key){document.querySelectorAll(".section").forEach(s=>s.classList.remove("open"));const el=document.querySelector(`.section[data-sec="${key}"]`);if(el)el.classList.add("open")}
let tick=null;
function setupIdleTimer(){if(idleTimer){clearTimeout(idleTimer);idleTimer=null}if(!prefs.sbAuto)return;idleTimer=setTimeout(()=>{prefs.standbyEnabled=true;applyStandbyState()},Math.max(1,prefs.sbIdleMins)*60000)}
function setupSleepTimer(){if(sleepTimer){clearTimeout(sleepTimer);sleepTimer=null}if(!prefs.standbyEnabled||!prefs.sbSleepMins)return;sleepTimer=setTimeout(()=>{standbyLayer.style.display="none"},Math.max(1,prefs.sbSleepMins)*60000)}
function renderStandby(){const lang=currentLang();const ui=T();const target=nextTargetInstant(lang);let text="";if(prefs.sbOnlyCountdown){const diff=target?target-new Date():0;const days=Math.max(0,Math.floor(diff/(1000*60*60*24)));const hours=pad(Math.max(0,Math.floor((diff/(1000*60*60))%24)));const mins=pad(Math.max(0,Math.floor((diff/(1000*60))%60)));const secs=pad(Math.max(0,Math.floor((diff/1000)%60)));text=ui.countdown(days,hours,mins,secs,prefs.countfmt)}else{text=isChristmasInTZ(lang.tz,lang.locale)?ui.yes:ui.no}
standbyMain.style.fontFamily=prefs.sbStyle==="futuristic"?"'Segment7','Digital-7',system-ui,Arial,Helvetica,sans-serif":"";standbyMain.style.textShadow=prefs.sbStyle==="futuristic"?"0 0 18px rgba(0,255,180,.35)":"none";standbyMain.style.filter=prefs.sbStyle==="elegant"?"blur(0.2px)":"";standbyLayer.style.background=prefs.sbDark?"#000":"var(--bg)";standbyLayer.style.color=prefs.sbDark?"#fff":"inherit";standbyMain.style.fontSize="clamp(1.4rem,6vw,2.4rem)";standbyMain.textContent=text;standbyClock.style.display=prefs.sbClock?"block":"none";if(prefs.sbClock){updateStandbyClock();if(!clockTick)clockTick=setInterval(updateStandbyClock,1000)}else{if(clockTick){clearInterval(clockTick);clockTick=null}}const pos=prefs.sbClockPos;standbyLayer.style.alignItems="center";standbyLayer.style.justifyContent=(pos==="center")?"center":(pos==="top")?"flex-start":"flex-end"}
function updateStandbyClock(){const d=new Date();let hh=d.getHours(),mm=d.getMinutes(),ss=d.getSeconds();let suffix="";if(prefs.sbClock12){suffix=hh>=12?" pm":" am";hh=hh%12||12}standbyClock.style.fontSize="clamp(1rem,5vw,1.6rem)";standbyClock.textContent=pad(hh)+":"+pad(mm)+":"+pad(ss)+suffix}
function applyStandbyState(){document.documentElement.setAttribute("data-standby",prefs.standbyEnabled?"on":"off");if(prefs.standbyEnabled){snowBeforeStandby=prefs.snow;toggleSnow(false);standbyLayer.style.display="flex";renderStandby();setupSleepTimer()}else{standbyLayer.style.display="none";if(clockTick){clearInterval(clockTick);clockTick=null}toggleSnow(snowBeforeStandby&&prefs.snow)}}
function hardResetStandbyAtLoad(){prefs.standbyEnabled=false}
["mousemove","keydown","pointerdown","wheel","touchstart"].forEach(ev=>document.addEventListener(ev,()=>{if(prefs.sbAuto)setupIdleTimer();if(prefs.standbyEnabled)renderStandby()},{passive:true}));
(function init(){
  hardResetStandbyAtLoad();
  if(prefs.loading)loadingOverlay.style.display="flex";
  if(!prefs._initialized&&prefs.autoDetect){const auto=pickUILangAuto();prefs.ui=auto;prefs._initialized=true;save(prefs)}
  applyTheme();applyDesign();applyCountStyle();document.documentElement.setAttribute("data-accessible",String(!!prefs.accessible));document.documentElement.setAttribute("data-panel-style",prefs.panelStyle);document.documentElement.setAttribute("data-mobile",prefs.mobileStyle);
  initSettingsControls();applyUIText();document.documentElement.lang=prefs.ui;setDropdownLabel(currentLang());renderList("");openSection("appearance");
  updateAll();tick=setInterval(updateAll,prefs.refresh);
  if(prefs.snow)toggleSnow(true);else toggleSnow(false);
  if(prefs.loading)setTimeout(()=>{loadingOverlay.style.display="none"},400);
  setupIdleTimer();applyStandbyState();
})();
</script>
</body>
</html>
